<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="小红书ui自动化测试, 您网站的关键字,支持多个值">
    <meta name="description" content="网站描述">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>小红书ui自动化测试 | YtlBlog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="YtlBlog" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">YtlBlog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">YtlBlog</div>
        <div class="logo-desc">
            
            网站描述
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/YtlGitHub" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/YtlGitHub" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/19.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">小红书ui自动化测试</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/">
                                <span class="chip bg-color">自动化测试</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/APP/" class="post-category">
                                APP
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-11-15
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>小红书ui自动化测试，运行RUN_main.py文件执行所有测试用例<br>用到了<a target="_blank" rel="noopener" href="http://e.betheme.net/article/show-80644.html?action=onClick">uiautomator2</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/baidu_39372836/article/details/122367121">uiautomator2笔记</a></p>
<h2 id="ui自动化框架"><a href="#ui自动化框架" class="headerlink" title="ui自动化框架"></a>ui自动化框架</h2><p>先看一下目录结构<br><img src="http://ytlgithub.github.io/medias/ytlimg/ui%E8%87%AA%E5%8A%A8%E5%8C%96%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.jpg" alt="目录结构"><br><img src="http://ytlgithub.github.io/medias/ytlimg/python%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99.jpg" alt="python命名规则"></p>
<h2 id="config"><a href="#config" class="headerlink" title="config"></a>config</h2><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">PACKAGE_NAME</span> <span class="token punctuation">:</span> com.xingin.xhs  <span class="token comment"># 包名</span>
<span class="token key atrule">MOBILE_IP</span> <span class="token punctuation">:</span> 192.168.16.185  <span class="token comment"># 输入手机ip</span>
<span class="token key atrule">CONNECT</span> <span class="token punctuation">:</span> usb  <span class="token comment"># 连接方式两种 USB和WiFi连接</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="目录结构内容如下"><a href="#目录结构内容如下" class="headerlink" title="目录结构内容如下"></a>目录结构内容如下</h2><h2 id="data"><a href="#data" class="headerlink" title="data"></a>data</h2><h3 id="json"><a href="#json" class="headerlink" title="json"></a>json</h3><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"用例1"</span><span class="token punctuation">,</span>
    <span class="token property">"data"</span><span class="token operator">:</span> <span class="token string">"用例参数"</span><span class="token punctuation">,</span>
    <span class="token property">"expected"</span><span class="token operator">:</span> <span class="token string">"预期结果"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"用例2"</span><span class="token punctuation">,</span>
    <span class="token property">"data"</span><span class="token operator">:</span> <span class="token string">"用例参数"</span><span class="token punctuation">,</span>
    <span class="token property">"expected"</span><span class="token operator">:</span> <span class="token string">"预期结果"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"用例3"</span><span class="token punctuation">,</span>
    <span class="token property">"data"</span><span class="token operator">:</span> <span class="token string">"用例参数"</span><span class="token punctuation">,</span>
    <span class="token property">"expected"</span><span class="token operator">:</span> <span class="token string">"预期结果"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="yaml"><a href="#yaml" class="headerlink" title="yaml"></a>yaml</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">title</span><span class="token punctuation">:</span> 用例1
  <span class="token key atrule">data</span><span class="token punctuation">:</span> 用例参数
  <span class="token key atrule">expected</span><span class="token punctuation">:</span> 预期结果

<span class="token punctuation">-</span> <span class="token key atrule">title</span><span class="token punctuation">:</span> 用例2
  <span class="token key atrule">data</span><span class="token punctuation">:</span> 用例参数
  <span class="token key atrule">expected</span><span class="token punctuation">:</span> 预期结果

<span class="token punctuation">-</span> <span class="token key atrule">title</span><span class="token punctuation">:</span> 用例4
  <span class="token key atrule">data</span><span class="token punctuation">:</span> 用例参数
  <span class="token key atrule">expected</span><span class="token punctuation">:</span> 预期结果<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="drivers"><a href="#drivers" class="headerlink" title="drivers"></a>drivers</h2><pre class="line-numbers language-drivers" data-language="drivers"><code class="language-drivers"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="log"><a href="#log" class="headerlink" title="log"></a>log</h2><pre class="line-numbers language-log" data-language="log"><code class="language-log"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="report"><a href="#report" class="headerlink" title="report"></a>report</h2><pre class="line-numbers language-report" data-language="report"><code class="language-report"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="script"><a href="#script" class="headerlink" title="script"></a>script</h2><h3 id="common"><a href="#common" class="headerlink" title="common"></a>common</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- ecoding: utf-8 -*-</span>
<span class="token comment"># @ModuleName: little_red_book</span>
<span class="token comment"># @Author: 杨天龙</span>
<span class="token comment"># @Time: 2022/11/8 21:47</span>
<span class="token keyword">import</span> unittest
<span class="token keyword">import</span> uiautomator2 <span class="token keyword">as</span> u2
<span class="token keyword">import</span> time
<span class="token keyword">import</span> os
<span class="token keyword">from</span> utils<span class="token punctuation">.</span>yamlconfig <span class="token keyword">import</span> ReadYaml


<span class="token keyword">class</span> <span class="token class-name">MyTest</span><span class="token punctuation">(</span>unittest<span class="token punctuation">.</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">setUpClass</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""整个测试用例的前置条件"""</span>
        <span class="token comment"># global PACKAGE_NAME</span>
        config_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'../..'</span><span class="token punctuation">,</span> <span class="token string">'config/config_file'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 配置文件路径</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>config_path<span class="token punctuation">,</span> <span class="token string">'配置文件路径'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>PACKAGE_NAME <span class="token operator">=</span> ReadYaml<span class="token punctuation">(</span>config_path<span class="token punctuation">,</span> <span class="token string">'PACKAGE_NAME'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_data<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 包名</span>
        MOBILE_IP <span class="token operator">=</span> ReadYaml<span class="token punctuation">(</span>config_path<span class="token punctuation">,</span> <span class="token string">'MOBILE_IP'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_data<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 手机ip</span>
        a <span class="token operator">=</span> ReadYaml<span class="token punctuation">(</span>config_path<span class="token punctuation">,</span> <span class="token string">"CONNECT"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_data<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 获取配置文件连接方式</span>
        <span class="token keyword">if</span> a <span class="token operator">==</span> <span class="token string">"USB"</span> <span class="token keyword">or</span> a <span class="token operator">==</span> <span class="token string">"usb"</span><span class="token punctuation">:</span>
            devices_serial <span class="token operator">=</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'adb devices'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>  <span class="token comment"># 获取设备序列号</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"USB连接"</span><span class="token punctuation">,</span> devices_serial<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>d <span class="token operator">=</span> u2<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>devices_serial<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"USB连接成功"</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>d <span class="token operator">=</span> u2<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"配置WIFI连接"</span><span class="token punctuation">)</span>
                os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">"adb tcpip 5555"</span><span class="token punctuation">)</span>  <span class="token comment"># 设置手机端口</span>
                MOBILE_IP <span class="token operator">=</span> MOBILE_IP  <span class="token comment"># 手机ip</span>
                os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"adb connect </span><span class="token interpolation"><span class="token punctuation">{</span>MOBILE_IP<span class="token punctuation">}</span></span><span class="token string">:5555"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"配置WIFI连接成功"</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"无线连接"</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>d <span class="token operator">=</span> u2<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>MOBILE_IP<span class="token punctuation">}</span></span><span class="token string">:5555"</span></span><span class="token punctuation">)</span>  <span class="token comment"># 用手机IP地址无线连接手机</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"无线连接成功"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>d<span class="token punctuation">.</span>click_post_delay <span class="token operator">=</span> <span class="token number">1.5</span>  <span class="token comment"># 定义全局等待时间为1.5s</span>
        self<span class="token punctuation">.</span>d<span class="token punctuation">.</span>implicitly_wait<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token comment"># print(self.d.device_info)</span>
        <span class="token comment"># 录屏操作</span>
        screen_record_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'../..'</span><span class="token punctuation">,</span> <span class="token string">'report/screen_record'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>screen_record_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>screen_record_path<span class="token punctuation">)</span>
        now <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 现在的时间</span>
        now_time <span class="token operator">=</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y%m%d_%H%M%S"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 当前时间</span>
        self<span class="token punctuation">.</span>d<span class="token punctuation">.</span>screenrecord<span class="token punctuation">(</span>screen_record_path<span class="token operator">+</span><span class="token string-interpolation"><span class="token string">f"/视频录制</span><span class="token interpolation"><span class="token punctuation">{</span>now_time<span class="token punctuation">}</span></span><span class="token string">.mp4"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>screen_record_path<span class="token punctuation">,</span> <span class="token string">'录屏保存目录'</span><span class="token punctuation">)</span>
        <span class="token comment"># 抓取手机日志并上传到电脑log目录</span>
        os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">"adb logcat -c"</span><span class="token punctuation">)</span>  <span class="token comment"># 抓取日志前，清除旧的日志信息</span>
        logcat_name <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'/logcat</span><span class="token interpolation"><span class="token punctuation">{</span>now_time<span class="token punctuation">}</span></span><span class="token string">.txt'</span></span>
        logcat_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'../..'</span><span class="token punctuation">,</span> <span class="token string">'log'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>logcat_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>logcat_path<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"生成log目录成功："</span><span class="token punctuation">,</span> logcat_path<span class="token punctuation">)</span>
        logcat <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"adb logcat -v time &gt; </span><span class="token interpolation"><span class="token punctuation">{</span>logcat_path<span class="token punctuation">}</span></span><span class="token string">"</span></span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>logcat<span class="token punctuation">,</span> <span class="token string">"logcat"</span><span class="token punctuation">)</span>
        os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span>logcat <span class="token operator">+</span> logcat_name<span class="token punctuation">)</span>  <span class="token comment"># 抓取日志</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>d<span class="token punctuation">.</span>current_app<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"当前运行的应用"</span><span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">tearDownClass</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""print("所有用例的后置条件")"""</span>
        <span class="token comment"># self.d.screenrecord.stop()  # 停止录屏</span>
        process <span class="token operator">=</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">"adb shell ps -A | findstr logcat"</span><span class="token punctuation">)</span>  <span class="token comment"># 获取logcat进程</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            process_id <span class="token operator">=</span> process<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment"># 获取logcat进程号</span>
            os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"adb shell kill </span><span class="token interpolation"><span class="token punctuation">{</span>process_id<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>  <span class="token comment"># 杀掉logcat进程</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">setUp</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""print("每条用例的前置条件")"""</span>
        self<span class="token punctuation">.</span>d<span class="token punctuation">.</span>app_start<span class="token punctuation">(</span>self<span class="token punctuation">.</span>PACKAGE_NAME<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">tearDown</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""print("每条用例的后置条件")"""</span>
        self<span class="token punctuation">.</span>d<span class="token punctuation">.</span>app_stop<span class="token punctuation">(</span>self<span class="token punctuation">.</span>PACKAGE_NAME<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">errorSaveScreenAsPhoto</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> error_module_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        now <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 现在的时间</span>
        now_time <span class="token operator">=</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y%m%d_%H%M%S"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 当前时间</span>
        error_screenshot_name <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>error_module_name<span class="token punctuation">}</span></span><span class="token string">错误截图</span><span class="token interpolation"><span class="token punctuation">{</span>now_time<span class="token punctuation">}</span></span><span class="token string">.png'</span></span>
        error_screenshot_path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'../..'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">/report/images/"</span></span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>error_screenshot_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>error_screenshot_path<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"生成错误截图目录成功："</span><span class="token punctuation">,</span> error_screenshot_path<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>d<span class="token punctuation">.</span>screenshot<span class="token punctuation">(</span>error_screenshot_path <span class="token operator">+</span> error_screenshot_name<span class="token punctuation">)</span>  <span class="token comment"># 错误截图保存路径</span>
        msg <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'&lt;img src="./images/</span><span class="token interpolation"><span class="token punctuation">{</span>error_screenshot_name<span class="token punctuation">}</span></span><span class="token string">" width="400" height="800" title="</span><span class="token interpolation"><span class="token punctuation">{</span>error_screenshot_name<span class="token punctuation">}</span></span><span class="token string">" alt="</span><span class="token interpolation"><span class="token punctuation">{</span>error_screenshot_name<span class="token punctuation">}</span></span><span class="token string">"/&gt;'</span></span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">assertEqualErrorSaveScreenAsPhoto</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> expected_results<span class="token punctuation">,</span> actual_result<span class="token punctuation">,</span> error_module_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""断言错误保存屏幕照片"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>expected_results<span class="token punctuation">,</span> actual_result<span class="token punctuation">,</span> msg<span class="token operator">=</span><span class="token string">"实际结果和预期结果不一致"</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>errorSaveScreenAsPhoto<span class="token punctuation">(</span>error_module_name<span class="token punctuation">)</span>
            <span class="token keyword">raise</span> e
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token string">'print("断言成功")'</span>
            <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">assertTrueEqualErrorSaveScreenAsPhoto</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> actual_result<span class="token punctuation">,</span> error_module_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""断言错误保存屏幕照片"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span>actual_result<span class="token punctuation">,</span> msg<span class="token operator">=</span><span class="token string">"没有找到预期结果元素"</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>errorSaveScreenAsPhoto<span class="token punctuation">(</span>error_module_name<span class="token punctuation">)</span>
            <span class="token keyword">raise</span> e
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token string">'print("断言成功")'</span>
            <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="page"><a href="#page" class="headerlink" title="page"></a>page</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="suit"><a href="#suit" class="headerlink" title="suit"></a>suit</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- ecoding: utf-8 -*-</span>
<span class="token comment"># @ModuleName: RUN</span>
<span class="token comment"># @Author: 杨天龙</span>
<span class="token comment"># @Time: 2022/11/8 23:08</span>
<span class="token comment"># 下载unittestreport：pip install unittestreport 生成测试报告和发邮件用，还可以做数据驱动</span>
<span class="token keyword">import</span> time
<span class="token keyword">import</span> unittest
<span class="token keyword">from</span> unittestreport <span class="token keyword">import</span> TestRunner
<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys
<span class="token comment"># 把当前项目路径临时添加到环境变量里，执行当前文件的窗口中有效，窗口关闭后即失效。</span>
sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'../..'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> utils<span class="token punctuation">.</span>HTMLTestRunner <span class="token keyword">import</span> HTMLTestRunner


<span class="token keyword">class</span> <span class="token class-name">RunAmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">run_main_unittestreport</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pattern<span class="token operator">=</span><span class="token string">"text*.py"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># case_path = os.getcwd()  # 获取当前路径</span>
        case_path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">/test_case/"</span></span>  <span class="token comment"># 获取用例路径</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>case_path<span class="token punctuation">,</span> <span class="token string">"用例路径"</span><span class="token punctuation">)</span>  <span class="token comment"># 打印用例路径</span>
        <span class="token comment">#  加载套件</span>
        suite <span class="token operator">=</span> unittest<span class="token punctuation">.</span>defaultTestLoader<span class="token punctuation">.</span>discover<span class="token punctuation">(</span>case_path<span class="token punctuation">,</span> pattern<span class="token operator">=</span>pattern<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"测试套件总用例数："</span><span class="token punctuation">,</span> suite<span class="token punctuation">.</span>countTestCases<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        now <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 现在的时间</span>
        now_time <span class="token operator">=</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y%m%d_%H%M%S"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 当前时间</span>
        report_name <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"测试报告</span><span class="token interpolation"><span class="token punctuation">{</span>now_time<span class="token punctuation">}</span></span><span class="token string">.html"</span></span>  <span class="token comment"># 报告名后面加当前时间</span>
        report_path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"../.."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">/report/'</span></span>  <span class="token comment"># 生成报告路径</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>report_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"生成报告目录"</span><span class="token punctuation">)</span>
            os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>report_path<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"生成报告目录成功:"</span><span class="token punctuation">,</span> report_path<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>report_path<span class="token punctuation">,</span> <span class="token string">"报告路径"</span><span class="token punctuation">)</span>  <span class="token comment"># 打印报告路径</span>
        runner <span class="token operator">=</span> TestRunner<span class="token punctuation">(</span>suite<span class="token punctuation">,</span>
                            filename<span class="token operator">=</span>report_name<span class="token punctuation">,</span>
                            report_dir<span class="token operator">=</span>report_path<span class="token punctuation">,</span>
                            title<span class="token operator">=</span><span class="token string">"小红书ui自动化测试报告"</span><span class="token punctuation">,</span>
                            tester<span class="token operator">=</span><span class="token string">"杨天龙"</span><span class="token punctuation">,</span>
                            desc<span class="token operator">=</span><span class="token string">"小红书首次登录，登入之后一级功能点检"</span><span class="token punctuation">,</span>
                            templates<span class="token operator">=</span><span class="token number">2</span>
                            <span class="token punctuation">)</span>
        runner<span class="token punctuation">.</span>rerun_run<span class="token punctuation">(</span>count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> interval<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># count：用来指定用例失败重运行的次数 interval：指定每次重运行的时间间隔</span>

        <span class="token comment"># 邮件发送测试报告</span>
        <span class="token comment"># runner.send_email(host="smtp.qq.com",</span>
        <span class="token comment">#                   port=465,  # 587</span>
        <span class="token comment">#                   user="176@qq.com",</span>
        <span class="token comment">#                   password="xxtdlejeiatfcdhd",</span>
        <span class="token comment">#                   to_addrs=["176@qq.com", "1632008076@qq.com"]</span>
        <span class="token comment">#                   )</span>

        <span class="token triple-quoted-string string">"""
        参数介绍 
        host： smtp服务器地址
        port：端口
        user：邮箱账号
        password：smtp服务授权码
        to_addrs：收件人邮箱地址（一个收件人传字符串，多个收件人传列表）
        """</span>
    <span class="token keyword">def</span> <span class="token function">run_main_htmltestrunner</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pattern<span class="token operator">=</span><span class="token string">"text*.py"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        now <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 现在的时间</span>
        now_time <span class="token operator">=</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y%m%d_%H%M%S"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 当前时间</span>
        report_name <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"测试报告</span><span class="token interpolation"><span class="token punctuation">{</span>now_time<span class="token punctuation">}</span></span><span class="token string">.html"</span></span>  <span class="token comment"># 报告名后面加当前时间</span>
        report_path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"../.."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">/report/'</span></span>  <span class="token comment"># 生成报告路径</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>report_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"生成报告目录"</span><span class="token punctuation">)</span>
            os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>report_path<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"生成报告目录成功:"</span><span class="token punctuation">,</span> report_path<span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>report_path<span class="token operator">+</span>report_name<span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fl<span class="token punctuation">:</span>
            case_path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">/test_case/"</span></span>  <span class="token comment"># 获取用例路径</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>case_path<span class="token punctuation">,</span> <span class="token string">"用例路径"</span><span class="token punctuation">)</span>  <span class="token comment"># 打印用例路径</span>
            discover <span class="token operator">=</span> unittest<span class="token punctuation">.</span>defaultTestLoader<span class="token punctuation">.</span>discover<span class="token punctuation">(</span>start_dir<span class="token operator">=</span>case_path<span class="token punctuation">,</span> pattern<span class="token operator">=</span>pattern<span class="token punctuation">)</span>
            runner <span class="token operator">=</span> HTMLTestRunner<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'测试标题'</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">'描述本次测试的大概内容'</span><span class="token punctuation">,</span> stream<span class="token operator">=</span>fl<span class="token punctuation">)</span>
            runner<span class="token punctuation">.</span>run<span class="token punctuation">(</span>discover<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    RunAmin<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>run_main_unittestreport<span class="token punctuation">(</span><span class="token string">"test_*.py"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="test-case"><a href="#test-case" class="headerlink" title="test_case"></a>test_case</h3><h4 id="test-00-first-open-app"><a href="#test-00-first-open-app" class="headerlink" title="test_00_first_open_app"></a>test_00_first_open_app</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- ecoding: utf-8 -*-</span>
<span class="token comment"># @ModuleName: test_00_first_open_app</span>
<span class="token comment"># @Author: 杨天龙</span>
<span class="token comment"># @Time: 2022/11/9 0:23</span>
<span class="token keyword">import</span> time
<span class="token keyword">from</span> script<span class="token punctuation">.</span>common<span class="token punctuation">.</span>little_red_book <span class="token keyword">import</span> MyTest


<span class="token keyword">class</span> <span class="token class-name">FirstOpenApp</span><span class="token punctuation">(</span>MyTest<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""首次打开app类"""</span>
    <span class="token keyword">def</span> <span class="token function">test_01</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> error_module_name<span class="token operator">=</span><span class="token string">"首次打开放弃使用"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""首次打开放弃使用"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">.</span>app_clear<span class="token punctuation">(</span>self<span class="token punctuation">.</span>PACKAGE_NAME<span class="token punctuation">)</span>  <span class="token comment"># 清理数据</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">.</span>app_start<span class="token punctuation">(</span>self<span class="token punctuation">.</span>PACKAGE_NAME<span class="token punctuation">)</span>  <span class="token comment"># 启动app</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"不同意"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 点击不同意</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"放弃使用"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 点击放弃使用</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>errorSaveScreenAsPhoto<span class="token punctuation">(</span>error_module_name<span class="token punctuation">)</span>
            <span class="token keyword">raise</span> e
        self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">test_02</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> error_module_name<span class="token operator">=</span><span class="token string">"首次打开同意"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""首次打开同意"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"同意"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 点击同意</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"其他账号"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"其他账号"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>errorSaveScreenAsPhoto<span class="token punctuation">(</span>error_module_name<span class="token punctuation">)</span>
            <span class="token keyword">raise</span> e
        actual_result <span class="token operator">=</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"其他登录方式"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 获取预期结果</span>
        self<span class="token punctuation">.</span>assertEqualErrorSaveScreenAsPhoto<span class="token punctuation">(</span><span class="token string">"其他登录方式"</span><span class="token punctuation">,</span> actual_result<span class="token punctuation">,</span> error_module_name<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">test_03</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> error_module_name<span class="token operator">=</span><span class="token string">"其他登录输入错误的验证码"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""其他登录输入错误的验证码"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"其他账号"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"其他账号"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"其他登录方式"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 点击登录方式</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>resourceId<span class="token operator">=</span><span class="token string">"com.xingin.xhs:id/abr"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 点击手机图标</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>resourceId<span class="token operator">=</span><span class="token string">"com.xingin.xhs:id/dfv"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">"17664014893"</span><span class="token punctuation">)</span>  <span class="token comment"># 输入账号</span>
            <span class="token comment"># self.d(resourceId="com.xingin.xhs:id/adx").click(timeout=5)  # 点击获取验证码</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>resourceId<span class="token operator">=</span><span class="token string">"com.xingin.xhs:id/emt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 点击"我已阅读并同意"前面那个小圆点</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>resourceId<span class="token operator">=</span><span class="token string">"com.xingin.xhs:id/ae1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span>  <span class="token comment"># 输入错误验证码</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"登录"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 点击登录</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>errorSaveScreenAsPhoto<span class="token punctuation">(</span>error_module_name<span class="token punctuation">)</span>
            <span class="token keyword">raise</span> e
        actual_result <span class="token operator">=</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"登录"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 获取预期结果</span>
        self<span class="token punctuation">.</span>assertEqualErrorSaveScreenAsPhoto<span class="token punctuation">(</span><span class="token string">"登录"</span><span class="token punctuation">,</span> actual_result<span class="token punctuation">,</span> error_module_name<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">test_04</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> error_module_name<span class="token operator">=</span><span class="token string">"微信登录"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""微信登录"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"其他账号"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"其他账号"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>resourceId<span class="token operator">=</span><span class="token string">"com.xingin.xhs:id/emt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 点击"我已阅读并同意"前面那个小圆点</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"微信登录"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 点击微信登录</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"允许"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"允许"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 点击允许</span>
                self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"跳过"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 点击跳过</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">.</span>swipe_ext<span class="token punctuation">(</span><span class="token string">"up"</span><span class="token punctuation">)</span>  <span class="token comment"># 向上滑动</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
            actual_result <span class="token operator">=</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"推荐"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_text<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment"># 获取实际结果</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>errorSaveScreenAsPhoto<span class="token punctuation">(</span>error_module_name<span class="token punctuation">)</span>
            <span class="token keyword">raise</span> e
        self<span class="token punctuation">.</span>assertEqualErrorSaveScreenAsPhoto<span class="token punctuation">(</span><span class="token string">"推荐"</span><span class="token punctuation">,</span> actual_result<span class="token punctuation">,</span> error_module_name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="test-01-home-page"><a href="#test-01-home-page" class="headerlink" title="test_01_home_page"></a>test_01_home_page</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- ecoding: utf-8 -*-</span>
<span class="token comment"># @ModuleName: test_01_home_page</span>
<span class="token comment"># @Author: 杨天龙</span>
<span class="token comment"># @Time: 2022/11/8 22:21</span>


<span class="token keyword">from</span> script<span class="token punctuation">.</span>common<span class="token punctuation">.</span>little_red_book <span class="token keyword">import</span> MyTest
<span class="token keyword">import</span> time


<span class="token keyword">class</span> <span class="token class-name">HomePage</span><span class="token punctuation">(</span>MyTest<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_01</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> error_module_name<span class="token operator">=</span><span class="token string">"检查首页tab"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""检查首页tab"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"允许"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"允许"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 点击允许</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"首页"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 点击首页</span>
            actual_result <span class="token operator">=</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"推荐"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 获取预期结果</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>errorSaveScreenAsPhoto<span class="token punctuation">(</span>error_module_name<span class="token punctuation">)</span>
            <span class="token keyword">raise</span> e
        self<span class="token punctuation">.</span>assertEqualErrorSaveScreenAsPhoto<span class="token punctuation">(</span><span class="token string">"推荐"</span><span class="token punctuation">,</span> actual_result<span class="token punctuation">,</span> error_module_name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="test-02-look-look"><a href="#test-02-look-look" class="headerlink" title="test_02_look_look"></a>test_02_look_look</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- ecoding: utf-8 -*-</span>
<span class="token comment"># @ModuleName: test_02_look_look</span>
<span class="token comment"># @Author: 杨天龙</span>
<span class="token comment"># @Time: 2022/11/8 22:48</span>
<span class="token keyword">from</span> script<span class="token punctuation">.</span>common<span class="token punctuation">.</span>little_red_book <span class="token keyword">import</span> MyTest


<span class="token keyword">class</span> <span class="token class-name">LookLook</span><span class="token punctuation">(</span>MyTest<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_01</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> error_module_name<span class="token operator">=</span><span class="token string">"检查视频/看看/购物tab"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""检查视频/看看/购物tab"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            actual_result <span class="token operator">=</span> <span class="token string">"实际结果True或Fail"</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"允许"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"允许"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 点击允许</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"视频"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"视频"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 点击视频</span>
                actual_result <span class="token operator">=</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"视频"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists  <span class="token comment"># 获取预期结果</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"看看"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"看看"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 点击看看</span>
                actual_result <span class="token operator">=</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"看看"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists  <span class="token comment"># 获取预期结果</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"购物"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"购物"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 点击购物</span>
                actual_result <span class="token operator">=</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"购物"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists  <span class="token comment"># 获取预期结果</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>errorSaveScreenAsPhoto<span class="token punctuation">(</span>error_module_name<span class="token punctuation">)</span>
            <span class="token keyword">raise</span> e
        self<span class="token punctuation">.</span>assertTrueEqualErrorSaveScreenAsPhoto<span class="token punctuation">(</span>actual_result<span class="token punctuation">,</span> error_module_name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="test-03-test-news"><a href="#test-03-test-news" class="headerlink" title="test_03_test_news"></a>test_03_test_news</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- ecoding: utf-8 -*-</span>
<span class="token comment"># @ModuleName: test_03_test_news</span>
<span class="token comment"># @Author: 杨天龙</span>
<span class="token comment"># @Time: 2022/11/8 23:33</span>
<span class="token keyword">from</span> script<span class="token punctuation">.</span>common<span class="token punctuation">.</span>little_red_book <span class="token keyword">import</span> MyTest


<span class="token keyword">class</span> <span class="token class-name">News</span><span class="token punctuation">(</span>MyTest<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""检查消息"""</span>
    <span class="token keyword">def</span> <span class="token function">test_01</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> error_module_name<span class="token operator">=</span><span class="token string">"检查消息"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""检查消息"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"允许"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"允许"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 点击允许</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"消息"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 点击消息</span>
            actual_result <span class="token operator">=</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"创建聊天"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 获取预期结果</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>errorSaveScreenAsPhoto<span class="token punctuation">(</span>error_module_name<span class="token punctuation">)</span>
            <span class="token keyword">raise</span> e
        self<span class="token punctuation">.</span>assertEqualErrorSaveScreenAsPhoto<span class="token punctuation">(</span><span class="token string">"创建聊天"</span><span class="token punctuation">,</span> actual_result<span class="token punctuation">,</span> error_module_name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="test-04-my"><a href="#test-04-my" class="headerlink" title="test_04_my"></a>test_04_my</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- ecoding: utf-8 -*-</span>
<span class="token comment"># @ModuleName: test_04_my</span>
<span class="token comment"># @Author: 杨天龙</span>
<span class="token comment"># @Time: 2022/11/8 23:41</span>
<span class="token keyword">from</span> script<span class="token punctuation">.</span>common<span class="token punctuation">.</span>little_red_book <span class="token keyword">import</span> MyTest


<span class="token keyword">class</span> <span class="token class-name">My</span><span class="token punctuation">(</span>MyTest<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""检查我tab"""</span>
    <span class="token keyword">def</span> <span class="token function">test_01</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> error_module_name<span class="token operator">=</span><span class="token string">"检查我tab"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""检查我tab"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"允许"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"允许"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 点击允许</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"我"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 点击我tab</span>
            actual_result <span class="token operator">=</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"关注"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 获取预期结果</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>errorSaveScreenAsPhoto<span class="token punctuation">(</span>error_module_name<span class="token punctuation">)</span>
            <span class="token keyword">raise</span> e
        self<span class="token punctuation">.</span>assertEqualErrorSaveScreenAsPhoto<span class="token punctuation">(</span><span class="token string">"关注"</span><span class="token punctuation">,</span> actual_result<span class="token punctuation">,</span> error_module_name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="test-ddt-cases"><a href="#test-ddt-cases" class="headerlink" title="test_ddt_cases"></a>test_ddt_cases</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- ecoding: utf-8 -*-</span>
<span class="token comment"># @ModuleName: test_ddt_login</span>
<span class="token comment"># @Author: 杨天龙</span>
<span class="token comment"># @Time: 2022/11/13 15:07</span>
<span class="token keyword">import</span> time
<span class="token keyword">import</span> os
<span class="token keyword">from</span> script<span class="token punctuation">.</span>common<span class="token punctuation">.</span>little_red_book <span class="token keyword">import</span> MyTest
<span class="token keyword">import</span> win32com<span class="token punctuation">.</span>client
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>support<span class="token punctuation">.</span>ui <span class="token keyword">import</span> WebDriverWait
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>by <span class="token keyword">import</span> By
<span class="token keyword">from</span> unittestreport <span class="token keyword">import</span> ddt<span class="token punctuation">,</span> list_data<span class="token punctuation">,</span> json_data<span class="token punctuation">,</span> yaml_data


<span class="token decorator annotation punctuation">@ddt</span>
<span class="token keyword">class</span> <span class="token class-name">FirstOpenApp</span><span class="token punctuation">(</span>MyTest<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""登录类"""</span>
    <span class="token keyword">def</span> <span class="token function">qtest_01</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> error_module_name<span class="token operator">=</span><span class="token string">"首次打开同意"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""首次打开同意"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">.</span>app_clear<span class="token punctuation">(</span>self<span class="token punctuation">.</span>PACKAGE_NAME<span class="token punctuation">)</span>  <span class="token comment"># 清楚数据</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">.</span>app_start<span class="token punctuation">(</span>self<span class="token punctuation">.</span>PACKAGE_NAME<span class="token punctuation">)</span>  <span class="token comment"># 启动app</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"同意"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 点击同意</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"其他账号"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"其他账号"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>errorSaveScreenAsPhoto<span class="token punctuation">(</span>error_module_name<span class="token punctuation">)</span>
            <span class="token keyword">raise</span> e
        actual_result <span class="token operator">=</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"其他登录方式"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 获取预期结果</span>
        self<span class="token punctuation">.</span>assertEqualErrorSaveScreenAsPhoto<span class="token punctuation">(</span><span class="token string">"其他登录方式"</span><span class="token punctuation">,</span> actual_result<span class="token punctuation">,</span> error_module_name<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">qtest_02</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> error_module_name<span class="token operator">=</span><span class="token string">"输入正确账号错误密码"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""输入空的账号空的密码"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"其他账号"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"其他账号"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"其他登录方式"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 点击其他登录方式</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>resourceId<span class="token operator">=</span><span class="token string">"com.xingin.xhs:id/abr"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 点击手机图标</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"手机密码登录"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 点击手机密码登录</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>resourceId<span class="token operator">=</span><span class="token string">"com.xingin.xhs:id/dfv"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">"17664014895"</span><span class="token punctuation">)</span>  <span class="token comment"># 输入账号</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>resourceId<span class="token operator">=</span><span class="token string">"com.xingin.xhs:id/dgk"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span>  <span class="token comment"># 输入密码</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>resourceId<span class="token operator">=</span><span class="token string">"com.xingin.xhs:id/emt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 点击"我已阅读并同意"前面那个小圆点</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>d<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"登录"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 点击登录</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>errorSaveScreenAsPhoto<span class="token punctuation">(</span>error_module_name<span class="token punctuation">)</span>
            <span class="token keyword">raise</span> e
        <span class="token comment"># while True:</span>
        <span class="token comment">#     toast = self.d.toast.get_message(wait_timeout=10, cache_timeout=10)</span>
        <span class="token comment">#     self.errorSaveScreenAsPhoto(error_module_name)  # 截图保存</span>
        <span class="token comment">#     print("toast111111")</span>
        <span class="token comment">#     if toast:</span>
        <span class="token comment">#         print(toast, "打印toast信息")  # 打印toast信息</span>
        <span class="token comment">#         self.errorSaveScreenAsPhoto(error_module_name)  # 错误截图保存</span>
        <span class="token comment">#         self.speaker.Speak(toast)</span>
        <span class="token comment">#         self.d.toast.reset()  # 在验证成功后及时清除缓存</span>
        <span class="token comment">#         break</span>
        <span class="token comment"># 用于生成xpath定位 相当于 "//*[@text='没有找到用户名或密码']"</span>
        toast_message <span class="token operator">=</span> <span class="token string">"没有找到用户名或密码"</span>
        message <span class="token operator">=</span> <span class="token string">'//*[@text=\'{}\']'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>toast_message<span class="token punctuation">)</span>

        <span class="token comment"># 获取toast提示框内容</span>
        toast_element <span class="token operator">=</span> WebDriverWait<span class="token punctuation">(</span>self<span class="token punctuation">.</span>d<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>until<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>toast_element<span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">"toast_element"</span><span class="token punctuation">)</span>
        expected_results <span class="token operator">=</span> <span class="token string">"账号或密码错误"</span>  <span class="token comment"># 预期结果</span>
        actual_result <span class="token operator">=</span> toast_element  <span class="token comment"># 实际结果</span>
        self<span class="token punctuation">.</span>speaker_assert<span class="token punctuation">(</span>expected_results<span class="token punctuation">,</span> actual_result<span class="token punctuation">)</span>  <span class="token comment"># 语音播报断言</span>
        self<span class="token punctuation">.</span>assertEqualErrorSaveScreenAsPhoto<span class="token punctuation">(</span>expected_results<span class="token punctuation">,</span> actual_result<span class="token punctuation">,</span> error_module_name<span class="token punctuation">)</span>

    cases_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'用例1'</span><span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">:</span> <span class="token string">'用例参数'</span><span class="token punctuation">,</span> <span class="token string">'expected'</span><span class="token punctuation">:</span> <span class="token string">'预期结果'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
             <span class="token punctuation">{</span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'用例2'</span><span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">:</span> <span class="token string">'用例参数'</span><span class="token punctuation">,</span> <span class="token string">'expected'</span><span class="token punctuation">:</span> <span class="token string">'预期结果'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
             <span class="token punctuation">{</span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'用例3'</span><span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">:</span> <span class="token string">'用例参数'</span><span class="token punctuation">,</span> <span class="token string">'expected'</span><span class="token punctuation">:</span> <span class="token string">'预期结果'</span><span class="token punctuation">}</span><span class="token punctuation">]</span>

    json_yaml_path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"../.."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">/data/'</span></span>  <span class="token comment"># 数据路径</span>

    <span class="token decorator annotation punctuation">@list_data</span><span class="token punctuation">(</span>cases_list<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">test_case_list</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@json_data</span><span class="token punctuation">(</span>json_yaml_path<span class="token operator">+</span><span class="token string">"/cases.json"</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">test_case_json</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@yaml_data</span><span class="token punctuation">(</span>json_yaml_path<span class="token operator">+</span><span class="token string">"/cases.yaml"</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">test_case_yaml</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="utils"><a href="#utils" class="headerlink" title="utils"></a>utils</h2><h3 id="get-device-ip"><a href="#get-device-ip" class="headerlink" title="get_device_ip"></a>get_device_ip</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- ecoding: utf-8 -*-</span>
<span class="token comment"># @ModuleName: get_device_ip</span>
<span class="token comment"># @Author: 杨天龙</span>
<span class="token comment"># @Time: 2022/11/11 0:43</span>
<span class="token keyword">import</span> os
<span class="token keyword">import</span> re


<span class="token keyword">def</span> <span class="token function">exec_cmd</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">:</span>
    cmd <span class="token operator">=</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span>cmd<span class="token punctuation">)</span>
    cmd_result <span class="token operator">=</span> cmd<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cmd<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> cmd_result


<span class="token keyword">def</span> <span class="token function">get_device_ip</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>
    math_obj <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'inet\s(\d+\.\d+\.\d+\.\d+).*?wlan0'</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span>
    <span class="token keyword">if</span> math_obj <span class="token keyword">and</span> math_obj<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> math_obj<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">None</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    result1 <span class="token operator">=</span> exec_cmd<span class="token punctuation">(</span><span class="token string">'adb shell ip addr show wlan0'</span><span class="token punctuation">)</span>
    ip <span class="token operator">=</span> get_device_ip<span class="token punctuation">(</span>result1<span class="token punctuation">)</span>  <span class="token comment"># 获得手机IP地址</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="HTMLTestRunner"><a href="#HTMLTestRunner" class="headerlink" title="HTMLTestRunner"></a>HTMLTestRunner</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""
A TestRunner for use with the Python unit testing framework. It
generates a HTML report to show the result at a glance.

The simplest way to use this is to invoke its main method. E.g.

    import unittest
    import HTMLTestRunner

    ... define your tests ...

    if __name__ == '__main__':
        HTMLTestRunner.main()


For more customization options, instantiates a HTMLTestRunner object.
HTMLTestRunner is a counterpart to unittest's TextTestRunner. E.g.

    # output to a file
    fp = file('my_report.html', 'wb')
    runner = HTMLTestRunner.HTMLTestRunner(
                stream=fp,
                title='My unit test',
                description='This demonstrates the report output by HTMLTestRunner.'
                )

    # Use an external stylesheet.
    # See the Template_mixin class for more customizable options
    runner.STYLESHEET_TMPL = '&lt;link rel="stylesheet" href="my_stylesheet.css" type="text/css"&gt;'

    # run the test
    runner.run(my_test_suite)


------------------------------------------------------------------------
Copyright (c) 2004-2007, Wai Yip Tung
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

* Redistributions of source code must retain the above copyright notice,
  this list of conditions and the following disclaimer.
* Redistributions in binary form must reproduce the above copyright
  notice, this list of conditions and the following disclaimer in the
  documentation and/or other materials provided with the distribution.
* Neither the name Wai Yip Tung nor the names of its contributors may be
  used to endorse or promote products derived from this software without
  specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER
OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
"""</span>

<span class="token comment"># URL: http://tungwaiyip.info/software/HTMLTestRunner.html</span>

__author__ <span class="token operator">=</span> <span class="token string">"Wai Yip Tung"</span>
__version__ <span class="token operator">=</span> <span class="token string">"0.8.2"</span>


<span class="token triple-quoted-string string">"""
Change History

Version 0.8.2
* Show output inline instead of popup window (Viorel Lupu).

Version in 0.8.1
* Validated XHTML (Wolfgang Borgert).
* Added description of test classes and test cases.

Version in 0.8.0
* Define Template_mixin class for customization.
* Workaround a IE 6 bug that it does not treat &lt;script&gt; block as CDATA.

Version in 0.7.1
* Back port to Python 2.3 (Frank Horowitz).
* Fix missing scroll bars in detail log (Podi).
"""</span>

<span class="token comment"># TODO: color stderr</span>
<span class="token comment"># TODO: simplify javascript using ,ore than 1 class in the class attribute?</span>

<span class="token keyword">import</span> datetime
<span class="token keyword">import</span> io  <span class="token comment"># import StringIO</span>
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> time
<span class="token keyword">import</span> unittest
<span class="token keyword">from</span> xml<span class="token punctuation">.</span>sax <span class="token keyword">import</span> saxutils


<span class="token comment"># ------------------------------------------------------------------------</span>
<span class="token comment"># The redirectors below are used to capture output during testing. Output</span>
<span class="token comment"># sent to sys.stdout and sys.stderr are automatically captured. However</span>
<span class="token comment"># in some cases sys.stdout is already cached before HTMLTestRunner is</span>
<span class="token comment"># invoked (e.g. calling logging.basicConfig). In order to capture those</span>
<span class="token comment"># output, use the redirectors for the cached stream.</span>
<span class="token comment">#</span>
<span class="token comment"># e.g.</span>
<span class="token comment">#   &gt;&gt;&gt; logging.basicConfig(stream=HTMLTestRunner.stdout_redirector)</span>
<span class="token comment">#   &gt;&gt;&gt;</span>

<span class="token keyword">class</span> <span class="token class-name">OutputRedirector</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" Wrapper to redirect stdout or stderr """</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> fp<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>fp <span class="token operator">=</span> fp

    <span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">'UTF-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># self.fp.write(s)</span>

    <span class="token keyword">def</span> <span class="token function">writelines</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> lines<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>fp<span class="token punctuation">.</span>writelines<span class="token punctuation">(</span>lines<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">flush</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>fp<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>

stdout_redirector <span class="token operator">=</span> OutputRedirector<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span>
stderr_redirector <span class="token operator">=</span> OutputRedirector<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span>



<span class="token comment"># ----------------------------------------------------------------------</span>
<span class="token comment"># Template</span>

<span class="token keyword">class</span> <span class="token class-name">Template_mixin</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Define a HTML template for report customerization and generation.

    Overall structure of an HTML report

    HTML
    +------------------------+
    |&lt;html&gt;                  |
    |  &lt;head&gt;                |
    |                        |
    |   STYLESHEET           |
    |   +----------------+   |
    |   |                |   |
    |   +----------------+   |
    |                        |
    |  &lt;/head&gt;               |
    |                        |
    |  &lt;body&gt;                |
    |                        |
    |   HEADING              |
    |   +----------------+   |
    |   |                |   |
    |   +----------------+   |
    |                        |
    |   REPORT               |
    |   +----------------+   |
    |   |                |   |
    |   +----------------+   |
    |                        |
    |   ENDING               |
    |   +----------------+   |
    |   |                |   |
    |   +----------------+   |
    |                        |
    |  &lt;/body&gt;               |
    |&lt;/html&gt;                 |
    +------------------------+
    """</span>

    STATUS <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">'pass'</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">'fail'</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token punctuation">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    DEFAULT_TITLE <span class="token operator">=</span> <span class="token string">'Unit Test Report'</span>
    DEFAULT_DESCRIPTION <span class="token operator">=</span> <span class="token string">''</span>

    <span class="token comment"># ------------------------------------------------------------------------</span>
    <span class="token comment"># HTML Template</span>

    HTML_TMPL <span class="token operator">=</span> <span class="token triple-quoted-string string">r"""&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
&lt;head&gt;
    &lt;title&gt;%(title)s&lt;/title&gt;
    &lt;meta name="generator" content="%(generator)s"/&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/&gt;
    %(stylesheet)s
&lt;/head&gt;
&lt;body&gt;
&lt;script language="javascript" type="text/javascript"&gt;&lt;!--
output_list = Array();

/* level - 0:Summary; 1:Failed; 2:All */
function showCase(level) {
    trs = document.getElementsByTagName("tr");
    for (var i = 0; i &lt; trs.length; i++) {
        tr = trs[i];
        id = tr.id;
        if (id.substr(0,2) == 'ft') {
            if (level &lt; 1) {
                tr.className = 'hiddenRow';
            }
            else {
                tr.className = '';
            }
        }
        if (id.substr(0,2) == 'pt') {
            if (level &gt; 1) {
                tr.className = '';
            }
            else {
                tr.className = 'hiddenRow';
            }
        }
    }
}


function showClassDetail(cid, count) {
    var id_list = Array(count);
    var toHide = 1;
    for (var i = 0; i &lt; count; i++) {
        tid0 = 't' + cid.substr(1) + '.' + (i+1);
        tid = 'f' + tid0;
        tr = document.getElementById(tid);
        if (!tr) {
            tid = 'p' + tid0;
            tr = document.getElementById(tid);
        }
        id_list[i] = tid;
        if (tr.className) {
            toHide = 0;
        }
    }
    for (var i = 0; i &lt; count; i++) {
        tid = id_list[i];
        if (toHide) {
            document.getElementById('div_'+tid).style.display = 'none'
            document.getElementById(tid).className = 'hiddenRow';
        }
        else {
            document.getElementById(tid).className = '';
        }
    }
}


function showTestDetail(div_id){
    var details_div = document.getElementById(div_id)
    var displayState = details_div.style.display
    // alert(displayState)
    if (displayState != 'block' ) {
        displayState = 'block'
        details_div.style.display = 'block'
    }
    else {
        details_div.style.display = 'none'
    }
}


function html_escape(s) {
    s = s.replace(/&amp;/g,'&amp;amp;');
    s = s.replace(/&lt;/g,'&amp;lt;');
    s = s.replace(/&gt;/g,'&amp;gt;');
    return s;
}

/* obsoleted by detail in &lt;div&gt;
function showOutput(id, name) {
    var w = window.open("", //url
                    name,
                    "resizable,scrollbars,status,width=800,height=450");
    d = w.document;
    d.write("&lt;pre&gt;");
    d.write(html_escape(output_list[id]));
    d.write("\n");
    d.write("&lt;a href='javascript:window.close()'&gt;close&lt;/a&gt;\n");
    d.write("&lt;/pre&gt;\n");
    d.close();
}
*/
--&gt;&lt;/script&gt;

%(heading)s
%(report)s
%(ending)s

&lt;/body&gt;
&lt;/html&gt;
"""</span>
    <span class="token comment"># variables: (title, generator, stylesheet, heading, report, ending)</span>


    <span class="token comment"># ------------------------------------------------------------------------</span>
    <span class="token comment"># Stylesheet</span>
    <span class="token comment">#</span>
    <span class="token comment"># alternatively use a &lt;link&gt; for external style sheet, e.g.</span>
    <span class="token comment">#   &lt;link rel="stylesheet" href="$url" type="text/css"&gt;</span>

    STYLESHEET_TMPL <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
&lt;style type="text/css" media="screen"&gt;
body        { font-family: verdana, arial, helvetica, sans-serif; font-size: 80%; }
table       { font-size: 100%; }
pre         { }

/* -- heading ---------------------------------------------------------------------- */
h1 {
	font-size: 16pt;
	color: gray;
}
.heading {
    margin-top: 0ex;
    margin-bottom: 1ex;
}

.heading .attribute {
    margin-top: 1ex;
    margin-bottom: 0;
}

.heading .description {
    margin-top: 4ex;
    margin-bottom: 6ex;
}

/* -- css div popup ------------------------------------------------------------------------ */
a.popup_link {
}

a.popup_link:hover {
    color: red;
}

.popup_window {
    display: none;
    position: relative;
    left: 0px;
    top: 0px;
    /*border: solid #627173 1px; */
    padding: 10px;
    background-color: #E6E6D6;
    font-family: "Lucida Console", "Courier New", Courier, monospace;
    text-align: left;
    font-size: 8pt;
    width: 500px;
}

}
/* -- report ------------------------------------------------------------------------ */
#show_detail_line {
    margin-top: 3ex;
    margin-bottom: 1ex;
}
#result_table {
    width: 80%;
    border-collapse: collapse;
    border: 1px solid #777;
}
#header_row {
    font-weight: bold;
    color: white;
    background-color: #777;
}
#result_table td {
    border: 1px solid #777;
    padding: 2px;
}
#total_row  { font-weight: bold; }
.passClass  { background-color: #6c6; }
.failClass  { background-color: #c60; }
.errorClass { background-color: #c00; }
.passCase   { color: #6c6; }
.failCase   { color: #c60; font-weight: bold; }
.errorCase  { color: #c00; font-weight: bold; }
.hiddenRow  { display: none; }
.testcase   { margin-left: 2em; }


/* -- ending ---------------------------------------------------------------------- */
#ending {
}

&lt;/style&gt;
"""</span>



    <span class="token comment"># ------------------------------------------------------------------------</span>
    <span class="token comment"># Heading</span>
    <span class="token comment">#</span>

    HEADING_TMPL <span class="token operator">=</span> <span class="token triple-quoted-string string">"""&lt;div class='heading'&gt;
&lt;h1&gt;%(title)s&lt;/h1&gt;
%(parameters)s
&lt;p class='description'&gt;%(description)s&lt;/p&gt;
&lt;/div&gt;

"""</span> <span class="token comment"># variables: (title, parameters, description)</span>

    HEADING_ATTRIBUTE_TMPL <span class="token operator">=</span> <span class="token triple-quoted-string string">"""&lt;p class='attribute'&gt;&lt;strong&gt;%(name)s:&lt;/strong&gt; %(value)s&lt;/p&gt;
"""</span> <span class="token comment"># variables: (name, value)</span>



    <span class="token comment"># ------------------------------------------------------------------------</span>
    <span class="token comment"># Report</span>
    <span class="token comment">#</span>

    REPORT_TMPL <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
&lt;p id='show_detail_line'&gt;Show
&lt;a href='javascript:showCase(0)'&gt;Summary&lt;/a&gt;
&lt;a href='javascript:showCase(1)'&gt;Failed&lt;/a&gt;
&lt;a href='javascript:showCase(2)'&gt;All&lt;/a&gt;
&lt;/p&gt;
&lt;table id='result_table'&gt;
&lt;colgroup&gt;
&lt;col align='left' /&gt;
&lt;col align='right' /&gt;
&lt;col align='right' /&gt;
&lt;col align='right' /&gt;
&lt;col align='right' /&gt;
&lt;col align='right' /&gt;
&lt;/colgroup&gt;
&lt;tr id='header_row'&gt;
    &lt;td&gt;Test Group/Test case&lt;/td&gt;
    &lt;td&gt;Count&lt;/td&gt;
    &lt;td&gt;Pass&lt;/td&gt;
    &lt;td&gt;Fail&lt;/td&gt;
    &lt;td&gt;Error&lt;/td&gt;
    &lt;td&gt;View&lt;/td&gt;
&lt;/tr&gt;
%(test_list)s
&lt;tr id='total_row'&gt;
    &lt;td&gt;Total&lt;/td&gt;
    &lt;td&gt;%(count)s&lt;/td&gt;
    &lt;td&gt;%(Pass)s&lt;/td&gt;
    &lt;td&gt;%(fail)s&lt;/td&gt;
    &lt;td&gt;%(error)s&lt;/td&gt;
    &lt;td&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;
"""</span> <span class="token comment"># variables: (test_list, count, Pass, fail, error)</span>

    REPORT_CLASS_TMPL <span class="token operator">=</span> <span class="token triple-quoted-string string">r"""
&lt;tr class='%(style)s'&gt;
    &lt;td&gt;%(desc)s&lt;/td&gt;
    &lt;td&gt;%(count)s&lt;/td&gt;
    &lt;td&gt;%(Pass)s&lt;/td&gt;
    &lt;td&gt;%(fail)s&lt;/td&gt;
    &lt;td&gt;%(error)s&lt;/td&gt;
    &lt;td&gt;&lt;a href="javascript:showClassDetail('%(cid)s',%(count)s)"&gt;Detail&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
"""</span> <span class="token comment"># variables: (style, desc, count, Pass, fail, error, cid)</span>


    REPORT_TEST_WITH_OUTPUT_TMPL <span class="token operator">=</span> <span class="token triple-quoted-string string">r"""
&lt;tr id='%(tid)s' class='%(Class)s'&gt;
    &lt;td class='%(style)s'&gt;&lt;div class='testcase'&gt;%(desc)s&lt;/div&gt;&lt;/td&gt;
    &lt;td colspan='5' align='center'&gt;

    &lt;!--css div popup start--&gt;
    &lt;a class="popup_link" onfocus='this.blur();' href="javascript:showTestDetail('div_%(tid)s')" &gt;
        %(status)s&lt;/a&gt;

    &lt;div id='div_%(tid)s' class="popup_window"&gt;
        &lt;div style='text-align: right; color:red;cursor:pointer'&gt;
        &lt;a onfocus='this.blur();' onclick="document.getElementById('div_%(tid)s').style.display = 'none' " &gt;
           [x]&lt;/a&gt;
        &lt;/div&gt;
        &lt;pre&gt;
        %(script)s
        &lt;/pre&gt;
    &lt;/div&gt;
    &lt;!--css div popup end--&gt;

    &lt;/td&gt;
&lt;/tr&gt;
"""</span> <span class="token comment"># variables: (tid, Class, style, desc, status)</span>


    REPORT_TEST_NO_OUTPUT_TMPL <span class="token operator">=</span> <span class="token triple-quoted-string string">r"""
&lt;tr id='%(tid)s' class='%(Class)s'&gt;
    &lt;td class='%(style)s'&gt;&lt;div class='testcase'&gt;%(desc)s&lt;/div&gt;&lt;/td&gt;
    &lt;td colspan='5' align='center'&gt;%(status)s&lt;/td&gt;
&lt;/tr&gt;
"""</span> <span class="token comment"># variables: (tid, Class, style, desc, status)</span>


    REPORT_TEST_OUTPUT_TMPL <span class="token operator">=</span> <span class="token triple-quoted-string string">r"""
%(id)s: %(output)s
"""</span> <span class="token comment"># variables: (id, output)</span>



    <span class="token comment"># ------------------------------------------------------------------------</span>
    <span class="token comment"># ENDING</span>
    <span class="token comment">#</span>

    ENDING_TMPL <span class="token operator">=</span> <span class="token triple-quoted-string string">"""&lt;div id='ending'&gt;&amp;nbsp;&lt;/div&gt;"""</span>

<span class="token comment"># -------------------- The end of the Template class -------------------</span>


TestResult <span class="token operator">=</span> unittest<span class="token punctuation">.</span>TestResult

<span class="token keyword">class</span> <span class="token class-name">_TestResult</span><span class="token punctuation">(</span>TestResult<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># note: _TestResult is a pure representation of results.</span>
    <span class="token comment"># It lacks the output and reporting ability compares to unittest._TextTestResult.</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> verbosity<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        TestResult<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>stdout0 <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>stderr0 <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>success_count <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>failure_count <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>error_count <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>verbosity <span class="token operator">=</span> verbosity

        <span class="token comment"># result is a list of result in 4 tuple</span>
        <span class="token comment"># (</span>
        <span class="token comment">#   result code (0: success; 1: fail; 2: error),</span>
        <span class="token comment">#   TestCase object,</span>
        <span class="token comment">#   Test output (byte string),</span>
        <span class="token comment">#   stack trace,</span>
        <span class="token comment"># )</span>
        self<span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>


    <span class="token keyword">def</span> <span class="token function">startTest</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> test<span class="token punctuation">)</span><span class="token punctuation">:</span>
        TestResult<span class="token punctuation">.</span>startTest<span class="token punctuation">(</span>self<span class="token punctuation">,</span> test<span class="token punctuation">)</span>
        <span class="token comment"># just one buffer for both stdout and stderr</span>
        self<span class="token punctuation">.</span>outputBuffer <span class="token operator">=</span> io<span class="token punctuation">.</span>StringIO<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># self.outputBuffer = StringIO.StringIO()</span>
        stdout_redirector<span class="token punctuation">.</span>fp <span class="token operator">=</span> self<span class="token punctuation">.</span>outputBuffer
        stderr_redirector<span class="token punctuation">.</span>fp <span class="token operator">=</span> self<span class="token punctuation">.</span>outputBuffer
        self<span class="token punctuation">.</span>stdout0 <span class="token operator">=</span> sys<span class="token punctuation">.</span>stdout
        self<span class="token punctuation">.</span>stderr0 <span class="token operator">=</span> sys<span class="token punctuation">.</span>stderr
        sys<span class="token punctuation">.</span>stdout <span class="token operator">=</span> stdout_redirector
        sys<span class="token punctuation">.</span>stderr <span class="token operator">=</span> stderr_redirector


    <span class="token keyword">def</span> <span class="token function">complete_output</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Disconnect output redirection and return buffer.
        Safe to call multiple times.
        """</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>stdout0<span class="token punctuation">:</span>
            sys<span class="token punctuation">.</span>stdout <span class="token operator">=</span> self<span class="token punctuation">.</span>stdout0
            sys<span class="token punctuation">.</span>stderr <span class="token operator">=</span> self<span class="token punctuation">.</span>stderr0
            self<span class="token punctuation">.</span>stdout0 <span class="token operator">=</span> <span class="token boolean">None</span>
            self<span class="token punctuation">.</span>stderr0 <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>outputBuffer<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span>


    <span class="token keyword">def</span> <span class="token function">stopTest</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> test<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Usually one of addSuccess, addError or addFailure would have been called.</span>
        <span class="token comment"># But there are some path in unittest that would bypass this.</span>
        <span class="token comment"># We must disconnect stdout in stopTest(), which is guaranteed to be called.</span>
        self<span class="token punctuation">.</span>complete_output<span class="token punctuation">(</span><span class="token punctuation">)</span>


    <span class="token keyword">def</span> <span class="token function">addSuccess</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> test<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>success_count <span class="token operator">+=</span> <span class="token number">1</span>
        TestResult<span class="token punctuation">.</span>addSuccess<span class="token punctuation">(</span>self<span class="token punctuation">,</span> test<span class="token punctuation">)</span>
        output <span class="token operator">=</span> self<span class="token punctuation">.</span>complete_output<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> test<span class="token punctuation">,</span> output<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>verbosity <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
            sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'ok '</span><span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'../venv/Lib'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">addError</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> test<span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>error_count <span class="token operator">+=</span> <span class="token number">1</span>
        TestResult<span class="token punctuation">.</span>addError<span class="token punctuation">(</span>self<span class="token punctuation">,</span> test<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        _<span class="token punctuation">,</span> _exc_str <span class="token operator">=</span> self<span class="token punctuation">.</span>errors<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
        output <span class="token operator">=</span> self<span class="token punctuation">.</span>complete_output<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> test<span class="token punctuation">,</span> output<span class="token punctuation">,</span> _exc_str<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>verbosity <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
            sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'E  '</span><span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'E'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">addFailure</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> test<span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>failure_count <span class="token operator">+=</span> <span class="token number">1</span>
        TestResult<span class="token punctuation">.</span>addFailure<span class="token punctuation">(</span>self<span class="token punctuation">,</span> test<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        _<span class="token punctuation">,</span> _exc_str <span class="token operator">=</span> self<span class="token punctuation">.</span>failures<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
        output <span class="token operator">=</span> self<span class="token punctuation">.</span>complete_output<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> test<span class="token punctuation">,</span> output<span class="token punctuation">,</span> _exc_str<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>verbosity <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
            sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'F  '</span><span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'F'</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">HTMLTestRunner</span><span class="token punctuation">(</span>Template_mixin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    """</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> stream<span class="token operator">=</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">,</span> verbosity<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>stream <span class="token operator">=</span> stream
        self<span class="token punctuation">.</span>verbosity <span class="token operator">=</span> verbosity
        <span class="token keyword">if</span> title <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>title <span class="token operator">=</span> self<span class="token punctuation">.</span>DEFAULT_TITLE
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>title <span class="token operator">=</span> title
        <span class="token keyword">if</span> description <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>description <span class="token operator">=</span> self<span class="token punctuation">.</span>DEFAULT_DESCRIPTION
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>description <span class="token operator">=</span> description

        self<span class="token punctuation">.</span>startTime <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>


    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> test<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token string">"Run the given test case or test suite."</span>
        result <span class="token operator">=</span> _TestResult<span class="token punctuation">(</span>self<span class="token punctuation">.</span>verbosity<span class="token punctuation">)</span>
        test<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>stopTime <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>generateReport<span class="token punctuation">(</span>test<span class="token punctuation">,</span> result<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\nTime Elapsed: %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>stopTime<span class="token operator">-</span>self<span class="token punctuation">.</span>startTime<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># print &gt;&gt;sys.stderr, '\nTime Elapsed: %s' % (self.stopTime-self.startTime)</span>
        <span class="token keyword">return</span> result


    <span class="token keyword">def</span> <span class="token function">sortResult</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> result_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># unittest does not seems to run in any particular order.</span>
        <span class="token comment"># Here at least we want to group them together by class.</span>
        rmap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        classes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> n<span class="token punctuation">,</span>t<span class="token punctuation">,</span>o<span class="token punctuation">,</span>e <span class="token keyword">in</span> result_list<span class="token punctuation">:</span>
            cls <span class="token operator">=</span> t<span class="token punctuation">.</span>__class__
            <span class="token keyword">if</span> <span class="token keyword">not</span> cls <span class="token keyword">in</span> rmap<span class="token punctuation">:</span>  <span class="token comment"># if not rmap.has_key(cls):</span>
                rmap<span class="token punctuation">[</span>cls<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                classes<span class="token punctuation">.</span>append<span class="token punctuation">(</span>cls<span class="token punctuation">)</span>
            rmap<span class="token punctuation">[</span>cls<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span>t<span class="token punctuation">,</span>o<span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
        r <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> rmap<span class="token punctuation">[</span>cls<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> cls <span class="token keyword">in</span> classes<span class="token punctuation">]</span>
        <span class="token keyword">return</span> r


    <span class="token keyword">def</span> <span class="token function">getReportAttributes</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Return report attributes as a list of (name, value).
        Override this to add custom attributes.
        """</span>
        startTime <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>startTime<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">]</span>
        duration <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>stopTime <span class="token operator">-</span> self<span class="token punctuation">.</span>startTime<span class="token punctuation">)</span>
        status <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> result<span class="token punctuation">.</span>success_count<span class="token punctuation">:</span> status<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'Pass %s'</span>    <span class="token operator">%</span> result<span class="token punctuation">.</span>success_count<span class="token punctuation">)</span>
        <span class="token keyword">if</span> result<span class="token punctuation">.</span>failure_count<span class="token punctuation">:</span> status<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'Failure %s'</span> <span class="token operator">%</span> result<span class="token punctuation">.</span>failure_count<span class="token punctuation">)</span>
        <span class="token keyword">if</span> result<span class="token punctuation">.</span>error_count<span class="token punctuation">:</span>   status<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'Error %s'</span>   <span class="token operator">%</span> result<span class="token punctuation">.</span>error_count  <span class="token punctuation">)</span>
        <span class="token keyword">if</span> status<span class="token punctuation">:</span>
            status <span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>status<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            status <span class="token operator">=</span> <span class="token string">'none'</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token punctuation">(</span><span class="token string">'Start Time'</span><span class="token punctuation">,</span> startTime<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'Duration'</span><span class="token punctuation">,</span> duration<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'Status'</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>


    <span class="token keyword">def</span> <span class="token function">generateReport</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> test<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">:</span>
        report_attrs <span class="token operator">=</span> self<span class="token punctuation">.</span>getReportAttributes<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        generator <span class="token operator">=</span> <span class="token string">'HTMLTestRunner %s'</span> <span class="token operator">%</span> __version__
        stylesheet <span class="token operator">=</span> self<span class="token punctuation">.</span>_generate_stylesheet<span class="token punctuation">(</span><span class="token punctuation">)</span>
        heading <span class="token operator">=</span> self<span class="token punctuation">.</span>_generate_heading<span class="token punctuation">(</span>report_attrs<span class="token punctuation">)</span>
        report <span class="token operator">=</span> self<span class="token punctuation">.</span>_generate_report<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        ending <span class="token operator">=</span> self<span class="token punctuation">.</span>_generate_ending<span class="token punctuation">(</span><span class="token punctuation">)</span>
        output <span class="token operator">=</span> self<span class="token punctuation">.</span>HTML_TMPL <span class="token operator">%</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>
            title <span class="token operator">=</span> saxutils<span class="token punctuation">.</span>escape<span class="token punctuation">(</span>self<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">,</span>
            generator <span class="token operator">=</span> generator<span class="token punctuation">,</span>
            stylesheet <span class="token operator">=</span> stylesheet<span class="token punctuation">,</span>
            heading <span class="token operator">=</span> heading<span class="token punctuation">,</span>
            report <span class="token operator">=</span> report<span class="token punctuation">,</span>
            ending <span class="token operator">=</span> ending<span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>write<span class="token punctuation">(</span>output<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


    <span class="token keyword">def</span> <span class="token function">_generate_stylesheet</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>STYLESHEET_TMPL


    <span class="token keyword">def</span> <span class="token function">_generate_heading</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> report_attrs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        a_lines <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> name<span class="token punctuation">,</span> value <span class="token keyword">in</span> report_attrs<span class="token punctuation">:</span>
            line <span class="token operator">=</span> self<span class="token punctuation">.</span>HEADING_ATTRIBUTE_TMPL <span class="token operator">%</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>
                    name <span class="token operator">=</span> saxutils<span class="token punctuation">.</span>escape<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    value <span class="token operator">=</span> saxutils<span class="token punctuation">.</span>escape<span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
            a_lines<span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">)</span>
        heading <span class="token operator">=</span> self<span class="token punctuation">.</span>HEADING_TMPL <span class="token operator">%</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>
            title <span class="token operator">=</span> saxutils<span class="token punctuation">.</span>escape<span class="token punctuation">(</span>self<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">,</span>
            parameters <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>a_lines<span class="token punctuation">)</span><span class="token punctuation">,</span>
            description <span class="token operator">=</span> saxutils<span class="token punctuation">.</span>escape<span class="token punctuation">(</span>self<span class="token punctuation">.</span>description<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">return</span> heading


    <span class="token keyword">def</span> <span class="token function">_generate_report</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">:</span>
        rows <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        sortedResult <span class="token operator">=</span> self<span class="token punctuation">.</span>sortResult<span class="token punctuation">(</span>result<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
        <span class="token keyword">for</span> cid<span class="token punctuation">,</span> <span class="token punctuation">(</span>cls<span class="token punctuation">,</span> cls_results<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>sortedResult<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># subtotal for a class</span>
            np <span class="token operator">=</span> nf <span class="token operator">=</span> ne <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">for</span> n<span class="token punctuation">,</span>t<span class="token punctuation">,</span>o<span class="token punctuation">,</span>e <span class="token keyword">in</span> cls_results<span class="token punctuation">:</span>
                <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span> np <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token keyword">elif</span> n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span> nf <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span> ne <span class="token operator">+=</span> <span class="token number">1</span>

            <span class="token comment"># format class description</span>
            <span class="token keyword">if</span> cls<span class="token punctuation">.</span>__module__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
                name <span class="token operator">=</span> cls<span class="token punctuation">.</span>__name__
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                name <span class="token operator">=</span> <span class="token string">"%s.%s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>cls<span class="token punctuation">.</span>__module__<span class="token punctuation">,</span> cls<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
            doc <span class="token operator">=</span> cls<span class="token punctuation">.</span>__doc__ <span class="token keyword">and</span> cls<span class="token punctuation">.</span>__doc__<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">or</span> <span class="token string">""</span>
            desc <span class="token operator">=</span> doc <span class="token keyword">and</span> <span class="token string">'%s: %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token keyword">or</span> name

            row <span class="token operator">=</span> self<span class="token punctuation">.</span>REPORT_CLASS_TMPL <span class="token operator">%</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>
                style <span class="token operator">=</span> ne <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token string">'errorClass'</span> <span class="token keyword">or</span> nf <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token string">'failClass'</span> <span class="token keyword">or</span> <span class="token string">'passClass'</span><span class="token punctuation">,</span>
                desc <span class="token operator">=</span> desc<span class="token punctuation">,</span>
                count <span class="token operator">=</span> np<span class="token operator">+</span>nf<span class="token operator">+</span>ne<span class="token punctuation">,</span>
                Pass <span class="token operator">=</span> np<span class="token punctuation">,</span>
                fail <span class="token operator">=</span> nf<span class="token punctuation">,</span>
                error <span class="token operator">=</span> ne<span class="token punctuation">,</span>
                cid <span class="token operator">=</span> <span class="token string">'c%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>cid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
            rows<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">)</span>

            <span class="token keyword">for</span> tid<span class="token punctuation">,</span> <span class="token punctuation">(</span>n<span class="token punctuation">,</span>t<span class="token punctuation">,</span>o<span class="token punctuation">,</span>e<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>cls_results<span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>_generate_report_test<span class="token punctuation">(</span>rows<span class="token punctuation">,</span> cid<span class="token punctuation">,</span> tid<span class="token punctuation">,</span> n<span class="token punctuation">,</span> t<span class="token punctuation">,</span> o<span class="token punctuation">,</span> e<span class="token punctuation">)</span>

        report <span class="token operator">=</span> self<span class="token punctuation">.</span>REPORT_TMPL <span class="token operator">%</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>
            test_list <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>rows<span class="token punctuation">)</span><span class="token punctuation">,</span>
            count <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>success_count<span class="token operator">+</span>result<span class="token punctuation">.</span>failure_count<span class="token operator">+</span>result<span class="token punctuation">.</span>error_count<span class="token punctuation">)</span><span class="token punctuation">,</span>
            Pass <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>success_count<span class="token punctuation">)</span><span class="token punctuation">,</span>
            fail <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>failure_count<span class="token punctuation">)</span><span class="token punctuation">,</span>
            error <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>error_count<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">return</span> report


    <span class="token keyword">def</span> <span class="token function">_generate_report_test</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> rows<span class="token punctuation">,</span> cid<span class="token punctuation">,</span> tid<span class="token punctuation">,</span> n<span class="token punctuation">,</span> t<span class="token punctuation">,</span> o<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># e.g. 'pt1.1', 'ft1.1', etc</span>
        has_output <span class="token operator">=</span> <span class="token builtin">bool</span><span class="token punctuation">(</span>o <span class="token keyword">or</span> e<span class="token punctuation">)</span>
        tid <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token string">'p'</span> <span class="token keyword">or</span> <span class="token string">'f'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'t%s.%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>cid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>tid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
        name <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
        doc <span class="token operator">=</span> t<span class="token punctuation">.</span>shortDescription<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token string">""</span>
        desc <span class="token operator">=</span> doc <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token string">'%s: %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> doc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">or</span> name
        tmpl <span class="token operator">=</span> has_output <span class="token keyword">and</span> self<span class="token punctuation">.</span>REPORT_TEST_WITH_OUTPUT_TMPL <span class="token keyword">or</span> self<span class="token punctuation">.</span>REPORT_TEST_NO_OUTPUT_TMPL

        <span class="token comment"># o and e should be byte string because they are collected from stdout and stderr?</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># TODO: some problem with 'string_escape': it escape \n and mess up formating</span>
            <span class="token comment"># uo = unicode(o.encode('string_escape'))</span>
            uo <span class="token operator">=</span> o  <span class="token comment"># uo = o.decode('latin-1')</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            uo <span class="token operator">=</span> o<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>  <span class="token comment"># uo = o</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># TODO: some problem with 'string_escape': it escape \n and mess up formating</span>
            <span class="token comment"># ue = unicode(e.encode('string_escape'))</span>
            ue<span class="token operator">=</span>e  <span class="token comment"># ue = e.decode('latin-1')</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            ue <span class="token operator">=</span> e<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>  <span class="token comment"># ue = e</span>

        script <span class="token operator">=</span> self<span class="token punctuation">.</span>REPORT_TEST_OUTPUT_TMPL <span class="token operator">%</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>
            <span class="token builtin">id</span> <span class="token operator">=</span> tid<span class="token punctuation">,</span>
            output <span class="token operator">=</span> saxutils<span class="token punctuation">.</span>escape<span class="token punctuation">(</span>uo<span class="token operator">+</span>ue<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>

        row <span class="token operator">=</span> tmpl <span class="token operator">%</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>
            tid <span class="token operator">=</span> tid<span class="token punctuation">,</span>
            Class <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token string">'hiddenRow'</span> <span class="token keyword">or</span> <span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            style <span class="token operator">=</span> n <span class="token operator">==</span> <span class="token number">2</span> <span class="token keyword">and</span> <span class="token string">'errorCase'</span> <span class="token keyword">or</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">and</span> <span class="token string">'failCase'</span> <span class="token keyword">or</span> <span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            desc <span class="token operator">=</span> desc<span class="token punctuation">,</span>
            script <span class="token operator">=</span> script<span class="token punctuation">,</span>
            status <span class="token operator">=</span> self<span class="token punctuation">.</span>STATUS<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
        rows<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> has_output<span class="token punctuation">:</span>
            <span class="token keyword">return</span>

    <span class="token keyword">def</span> <span class="token function">_generate_ending</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>ENDING_TMPL


<span class="token comment">##############################################################################</span>
<span class="token comment"># Facilities for running tests from the command line</span>
<span class="token comment">##############################################################################</span>

<span class="token comment"># Note: Reuse unittest.TestProgram to launch test. In the future we may</span>
<span class="token comment"># build our own launcher to support more specific command line</span>
<span class="token comment"># parameters like test title, CSS, etc.</span>
<span class="token keyword">class</span> <span class="token class-name">TestProgram</span><span class="token punctuation">(</span>unittest<span class="token punctuation">.</span>TestProgram<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    A variation of the unittest.TestProgram. Please refer to the base
    class for command line parameters.
    """</span>
    <span class="token keyword">def</span> <span class="token function">runTests</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Pick HTMLTestRunner as the default test runner.</span>
        <span class="token comment"># base class's testRunner parameter is not useful because it means</span>
        <span class="token comment"># we have to instantiate HTMLTestRunner before we know self.verbosity.</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>testRunner <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>testRunner <span class="token operator">=</span> HTMLTestRunner<span class="token punctuation">(</span>verbosity<span class="token operator">=</span>self<span class="token punctuation">.</span>verbosity<span class="token punctuation">)</span>
        unittest<span class="token punctuation">.</span>TestProgram<span class="token punctuation">.</span>runTests<span class="token punctuation">(</span>self<span class="token punctuation">)</span>

main <span class="token operator">=</span> TestProgram

<span class="token comment">##############################################################################</span>
<span class="token comment"># Executing this module from the command line</span>
<span class="token comment">##############################################################################</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span>module<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="yamlconfig"><a href="#yamlconfig" class="headerlink" title="yamlconfig"></a>yamlconfig</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- ecoding: utf-8 -*-</span>
<span class="token comment"># @ModuleName: yamlconfig</span>
<span class="token comment"># @Author: 杨天龙</span>
<span class="token comment"># @Time: 2022/11/11 21:42</span>
<span class="token keyword">import</span> os
<span class="token keyword">import</span> yaml


<span class="token keyword">class</span> <span class="token class-name">ReadYaml</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> config_path<span class="token punctuation">,</span> param<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>config_path <span class="token operator">=</span> config_path  <span class="token comment"># 配置文件路径</span>
        self<span class="token punctuation">.</span>param <span class="token operator">=</span> param  <span class="token comment"># 不传默认获取所有数据</span>

    <span class="token keyword">def</span> <span class="token function">get_data</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>config_path<span class="token punctuation">,</span>encoding<span class="token operator">=</span>encoding<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            config_data <span class="token operator">=</span> yaml<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Loader<span class="token operator">=</span>yaml<span class="token punctuation">.</span>FullLoader<span class="token punctuation">)</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>param <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> config_data
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> config_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span>self<span class="token punctuation">.</span>param<span class="token punctuation">)</span>  <span class="token comment"># 获取键为param的值</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    config_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">,</span> <span class="token string">'config/config_file'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> ReadYaml<span class="token punctuation">(</span>config_path<span class="token punctuation">,</span> <span class="token string">'PACKAGE_NAME'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="README-md"><a href="#README-md" class="headerlink" title="README.md"></a>README.md</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 说明性文件，告诉团队成员框架需要的环境以及用法 #</span>

小红书ui自动化测试，运行RUN_main<span class="token punctuation">.</span>py文件执行所有测试用例
用到了<span class="token punctuation">[</span>uiautomator2<span class="token punctuation">]</span><span class="token punctuation">(</span>http<span class="token punctuation">:</span><span class="token operator">//</span>e<span class="token punctuation">.</span>betheme<span class="token punctuation">.</span>net<span class="token operator">/</span>article<span class="token operator">/</span>show<span class="token operator">-</span><span class="token number">80644.</span>html?action<span class="token operator">=</span>onClick<span class="token punctuation">)</span>
<span class="token punctuation">[</span>uiautomator2笔记<span class="token punctuation">]</span><span class="token punctuation">(</span>https<span class="token punctuation">:</span><span class="token operator">//</span>blog<span class="token punctuation">.</span>csdn<span class="token punctuation">.</span>net<span class="token operator">/</span>baidu_39372836<span class="token operator">/</span>article<span class="token operator">/</span>details<span class="token operator">/</span><span class="token number">122367121</span><span class="token punctuation">)</span>

<span class="token comment">## Uiautomator2原理介绍</span>
<span class="token number">1.</span>uiautomator2 是一个可以使用Python对Android设备进行UI自动化的库。其底层基于Google uiautomator，Google提供的uiautomator库可以获取屏幕上任意一个APP的任意一个控件属性，并对其进行任意操作，目前仅支持android平台的原生应用测试，

<span class="token comment">## 安装uiautomator2</span>
pip install uiautomator2
pip install pillow  <span class="token comment"># 截图用</span>
pip install weditor  <span class="token comment"># 查看元素</span>
pip install unittestreport  <span class="token comment"># 生成测试报告，发邮件，数据驱动</span>

<span class="token comment">##  录制视频用到</span>
pip3 install <span class="token operator">-</span>U <span class="token string">"uiautomator2[image]"</span> <span class="token operator">-</span>i https<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>doubanio<span class="token punctuation">.</span>com<span class="token operator">/</span>simple

<span class="token punctuation">[</span>comment<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">&lt;&gt;</span> <span class="token punctuation">(</span>pip install opencv<span class="token operator">-</span>python<span class="token punctuation">)</span>

<span class="token punctuation">[</span>comment<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">&lt;&gt;</span> <span class="token punctuation">(</span>pip install imageio<span class="token punctuation">)</span>
 
<span class="token comment">## 初始化</span>
部署相关的守护进程。
电脑连接上一个手机或多个手机<span class="token punctuation">,</span> 确保adb已经添加到环境变量中，执行下面的命令会自动安装本库所需要的设备端程序：uiautomator<span class="token operator">-</span>server 、atx<span class="token operator">-</span>agent、openstf<span class="token operator">/</span>minicap、openstf<span class="token operator">/</span>minitouch
python <span class="token operator">-</span>m uiautomator2 init
安装完成，设备上会多一个uiautomator的应用。
配置手机设备参数：
有两种方法，一种是通过WIFI，另一种是通过USB数据线将手机链接电脑。
WiFi连接更方便一点，需要保持PC和手机使用的一个WIFI，查看手机连接WIFI的IP地址。

<span class="token comment">## 测试</span>
<span class="token keyword">import</span> uiautomator2 <span class="token keyword">as</span> u2
d <span class="token operator">=</span> u2<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>info<span class="token punctuation">)</span>

<span class="token comment">## adb命令logcat抓取日志</span>
<span class="token punctuation">[</span>链接地址<span class="token punctuation">]</span><span class="token punctuation">(</span>https<span class="token punctuation">:</span><span class="token operator">//</span>blog<span class="token punctuation">.</span>csdn<span class="token punctuation">.</span>net<span class="token operator">/</span>m0_64776928<span class="token operator">/</span>article<span class="token operator">/</span>details<span class="token operator">/</span><span class="token number">126005119</span><span class="token punctuation">)</span>
adb shell ps <span class="token operator">-</span>A <span class="token operator">|</span> grep logcat  <span class="token comment"># 查看log进程(在windows下将grep换成findstr)</span>
adb shell kill 进程号  <span class="token comment"># 杀死进程</span>

<span class="token comment">## 二者的区别是：spa</span>
使用os<span class="token punctuation">.</span>popen来获取设备号，使用os<span class="token punctuation">.</span>system来启动macaca服务
（<span class="token number">1</span>）os<span class="token punctuation">.</span>system<span class="token punctuation">(</span>cmd<span class="token punctuation">)</span>的返回值只会有<span class="token number">0</span><span class="token punctuation">(</span>成功<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2c</span>
（<span class="token number">2</span>）os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span>cmd<span class="token punctuation">)</span>会把执行的cmd的输出做为值返回。
popen
此方法能够使用read、readline、readlines方法进行内容操做。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Ytl</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://ytlgithub.github.io/2022/11/15/xiao-hong-shu-ui-zi-dong-hua-ce-shi/">https://ytlgithub.github.io/2022/11/15/xiao-hong-shu-ui-zi-dong-hua-ce-shi/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Ytl</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/">
                                    <span class="chip bg-color">自动化测试</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="far fa-dot-circle"></i>&nbsp;本篇
            </div>
            <div class="card">
                <a href="/2022/11/15/xiao-hong-shu-ui-zi-dong-hua-ce-shi/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/19.jpg" class="responsive-img" alt="小红书ui自动化测试">
                        
                        <span class="card-title">小红书ui自动化测试</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-11-15
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/APP/" class="post-category">
                                    APP
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/">
                        <span class="chip bg-color">自动化测试</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/08/18/linux-li-mian-an-zhuang-mysql/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/20.jpg" class="responsive-img" alt="linux里面安装Mysql">
                        
                        <span class="card-title">linux里面安装Mysql</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-08-18
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/linux/" class="post-category">
                                    linux
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/linux/">
                        <span class="chip bg-color">linux</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="3215936658"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2022</span>
            
            <span id="year">2019</span>
            <a href="/about" target="_blank">Ytl</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/YtlGitHub" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1766842398@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1766842398" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1766842398" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
